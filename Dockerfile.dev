FROM node:18-alpine

WORKDIR /app

# Устанавливаем переменные окружения для development
ENV NODE_ENV=development
ENV CURRENT_ENV=development

# Устанавливаем nodemon глобально для hot-reload
RUN npm install -g nodemon

COPY package*.json ./

# Устанавливаем все зависимости (включая devDependencies)
RUN npm install

COPY . .

# RUN mkdir -p /app/keys/rsa
RUN mkdir -p /app/keys/ec

EXPOSE 3000

# Используем startup script, который запустит миграции, сиды и затем nodemon для автоматической перезагрузки
CMD ["npm", "run", "start:docker"]

